/*
Timbre data generated from {Dan's dir, not in this repo}/computerMusicPlayground/vowel.ipynb
*/

#include <math.h>

#include "role.h"
#include "timbre.h"
#include "music.h"

#ifndef ROLE
    I am using syntax error to denote undefined macro here!
#endif
#if ROLE == 'F'
float TIMBRE_FLUTE[TIMBRE_LEN] = {
    0.13676878662109376f, 
    0.13676878662109376f, 
    0.13676878662109376f, 
    0.13676878662109376f, 
    0.13676878662109376f, 
    0.13676878662109376f, 
    0.13676878662109376f, 
    0.13676878662109376f, 
    0.2327656005859375f, 
    0.2327656005859375f, 
    0.11663565673828126f, 
    0.12271953125f, 
    0.12271953125f, 
    0.12271953125f, 
    0.09569869384765625f, 
    0.09569869384765625f, 
    0.09569869384765625f, 
    0.253130078125f, 
    0.12710006103515625f, 
    0.12710006103515625f, 
    0.036081689453125f, 
    0.036081689453125f, 
    0.07039032592773438f, 
    0.025634671020507815f, 
    0.025634671020507815f, 
    0.20156268310546877f, 
    0.0039300498962402345f, 
    0.29150974121093753f, 
    0.027677261352539066f, 
    0.07467901000976562f, 
    0.032162060546875f, 
    0.008509994506835938f, 
    0.016688189697265626f, 
    0.02972444763183594f, 
    0.01769535675048828f, 
    0.003682607650756836f, 
    0.02248181304931641f, 
    0.005784563827514648f, 
    0.007685343170166016f, 
    0.002239899444580078f, 
    0, 
    0.0074455039978027346f, 
    0.0015351497650146486f, 
    0.0024925634384155276f, 
    0.016617822265625002f, 
    0.001835605239868164f, 
    0.0025110095977783206f, 
    0.011419316101074219f, 
    0.00209945125579834f, 
};

float TIMBRE_O[TIMBRE_LEN] = {
    0.1384379267692566f, 
    0.1384379267692566f, 
    0.1595824658870697f, 
    0.1595824658870697f, 
    0.1595824658870697f, 
    0.1595824658870697f, 
    0.1595824658870697f, 
    0.1595824658870697f, 
    0.1595824658870697f, 
    0.1595824658870697f, 
    0.1595824658870697f, 
    0.13624459505081177f, 
    0.13624459505081177f, 
    0.13624459505081177f, 
    0.13624459505081177f, 
    0.13624459505081177f, 
    0.0989791601896286f, 
    0.0989791601896286f, 
    0.0989791601896286f, 
    0.0989791601896286f, 
    0.0989791601896286f, 
    0.07051660120487213f, 
    0.07051660120487213f, 
    0.07051660120487213f, 
    0.027671409770846367f, 
    0.027671409770846367f, 
    0.027671409770846367f, 
    0.008150024339556694f, 
    0.008150024339556694f, 
    0.008150024339556694f, 
    0.003255735617130995f, 
    0.003255735617130995f, 
    0.0021329736337065697f, 
    0.0021329736337065697f, 
    0.0017258117441087961f, 
    0.0014302838826552033f, 
    0.0014302838826552033f, 
    0.0011935214279219508f, 
    0.0018058066489174962f, 
    0.0018058066489174962f, 
    0.005188279785215855f, 
    0.009203758090734482f, 
    0.006568075157701969f, 
    0.005462259985506535f, 
    0.007372932508587837f, 
    0.008421114645898342f, 
    0.01693969964981079f, 
    0.027717644348740578f, 
    0.023745326325297356f, 
};

float TIMBRE_E[TIMBRE_LEN] = {
    0.10354970395565033f, 
    0.10354970395565033f, 
    0.08122344315052032f, 
    0.08122344315052032f, 
    0.08122344315052032f, 
    0.08122344315052032f, 
    0.08122344315052032f, 
    0.08122344315052032f, 
    0.08122344315052032f, 
    0.08122344315052032f, 
    0.08122344315052032f, 
    0.0656677857041359f, 
    0.0656677857041359f, 
    0.0656677857041359f, 
    0.0656677857041359f, 
    0.0656677857041359f, 
    0.04599497467279434f, 
    0.04599497467279434f, 
    0.04599497467279434f, 
    0.04599497467279434f, 
    0.04599497467279434f, 
    0.028560925275087357f, 
    0.028560925275087357f, 
    0.028560925275087357f, 
    0.027941416949033737f, 
    0.027941416949033737f, 
    0.027941416949033737f, 
    0.03571392595767975f, 
    0.03571392595767975f, 
    0.03571392595767975f, 
    0.07033979892730713f, 
    0.07033979892730713f, 
    0.09519024193286896f, 
    0.09519024193286896f, 
    0.05270583927631378f, 
    0.03303563594818115f, 
    0.03303563594818115f, 
    0.025613494217395782f, 
    0.03393898159265518f, 
    0.03393898159265518f, 
    0.024858759716153145f, 
    0.007554360665380955f, 
    0.006552846170961857f, 
    0.01311464048922062f, 
    0.02517847716808319f, 
    0.043138451874256134f, 
    0.0447988361120224f, 
    0.03307017683982849f, 
    0.026044737547636032f, 
};

float TIMBRE_I[TIMBRE_LEN] = {
    0.1664794385433197f, 
    0.1664794385433197f, 
    0.17995575070381165f, 
    0.17995575070381165f, 
    0.17995575070381165f, 
    0.17995575070381165f, 
    0.17995575070381165f, 
    0.17995575070381165f, 
    0.17995575070381165f, 
    0.17995575070381165f, 
    0.17995575070381165f, 
    0.06682148575782776f, 
    0.06682148575782776f, 
    0.06682148575782776f, 
    0.06682148575782776f, 
    0.06682148575782776f, 
    0.010807662270963192f, 
    0.010807662270963192f, 
    0.010807662270963192f, 
    0.010807662270963192f, 
    0.010807662270963192f, 
    0.005849966313689947f, 
    0.005849966313689947f, 
    0.005849966313689947f, 
    0.003625248558819294f, 
    0.003625248558819294f, 
    0.003625248558819294f, 
    0.0033453055657446384f, 
    0.0033453055657446384f, 
    0.0033453055657446384f, 
    0.003931320738047361f, 
    0.003931320738047361f, 
    0.007415485568344593f, 
    0.007415485568344593f, 
    0.022200612351298332f, 
    0.03269781917333603f, 
    0.03269781917333603f, 
    0.018464524298906326f, 
    0.00798204354941845f, 
    0.00798204354941845f, 
    0.009506084024906158f, 
    0.013995479792356491f, 
    0.014477178454399109f, 
    0.01638801582157612f, 
    0.02977018803358078f, 
    0.05147349461913109f, 
    0.05077257752418518f, 
    0.030916307121515274f, 
    0.018268100917339325f, 
};

float TIMBRE_A[TIMBRE_LEN] = {
    0.06797970831394196f, 
    0.06797970831394196f, 
    0.0501837432384491f, 
    0.0501837432384491f, 
    0.0501837432384491f, 
    0.0501837432384491f, 
    0.0501837432384491f, 
    0.0501837432384491f, 
    0.0501837432384491f, 
    0.0501837432384491f, 
    0.0501837432384491f, 
    0.0548306405544281f, 
    0.0548306405544281f, 
    0.0548306405544281f, 
    0.0548306405544281f, 
    0.0548306405544281f, 
    0.09646505117416382f, 
    0.09646505117416382f, 
    0.09646505117416382f, 
    0.09646505117416382f, 
    0.09646505117416382f, 
    0.14627936482429504f, 
    0.14627936482429504f, 
    0.14627936482429504f, 
    0.19600382447242737f, 
    0.19600382447242737f, 
    0.19600382447242737f, 
    0.16037645936012268f, 
    0.16037645936012268f, 
    0.16037645936012268f, 
    0.04579254984855652f, 
    0.04579254984855652f, 
    0.011577246710658073f, 
    0.011577246710658073f, 
    0.008985684253275394f, 
    0.008734888397157192f, 
    0.008734888397157192f, 
    0.006263165734708309f, 
    0.007249779067933559f, 
    0.007249779067933559f, 
    0.009634723886847496f, 
    0.009544684551656246f, 
    0.007983824238181114f, 
    0.010905926115810871f, 
    0.01612766645848751f, 
    0.026307150721549988f, 
    0.03298357129096985f, 
    0.0333976075053215f, 
    0.019606037065386772f, 
};

float* TIMBRES[N_TIMBRES] = {
    TIMBRE_FLUTE, 
    TIMBRE_O, 
    TIMBRE_E, 
    TIMBRE_I, 
    TIMBRE_A, 
};

float timbreAt(float freq, float* timbre) {
    float pitch = freq2pitch(freq);
    float index = pitch - TIMBRE_PITCH_BOTTOM;
    if (index <= 0)
        return timbre[0];
    if (index >= TIMBRE_LEN - 1)
        return 0;
    float left_f = floorf(index);
    int left = (int)left_f;
    float w = index - left_f;
    return timbre[left] * (1 - w) + timbre[left + 1] * w;
}
#endif
